import"../chunks/DsnmJJEf.js";import"../chunks/Cimollut.js";import{o as bn,a as vn}from"../chunks/B_jID4d2.js";import{p as yn,f as At,b as y,h as gn,c as A,a as Rt,i as hn,w as In,e as Y,r as F}from"../chunks/Nxf_S6m2.js";import{h as En}from"../chunks/BKk_KKHJ.js";import{i as xn}from"../chunks/DIW6s7ce.js";var wn=In(At('<script src="https://unpkg.com/meyda/dist/web/meyda.min.js"><\/script> <script src="https://cdn.jsdelivr.net/npm/numericjs@1.2.6/numeric-1.2.6.min.js"><\/script> <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"><\/script>',1)),Mn=At('<div id="overlay"><div><div class="spinner"></div><div id="overlayMsg">processing...</div></div></div> <div id="noticeModal"><div class="noticeCard"><div class="noticeTitle">ã”æ³¨æ„</div> <div id="noticeMessage" class="noticeMessage"></div> <div class="noticeActions"><button id="noticeClose" class="btn-theme">OK</button></div></div></div> <div id="labelModal"><div class="noticeCard"><div class="noticeTitle">ãƒ©ãƒ™ãƒ«ç·¨é›†</div> <div id="labelEditMessage" class="noticeMessage" style="margin-bottom:12px;"></div> <div class="modalField" style="margin-top:10px;"><label for="labelEditSelect">æ•°å€¤ãƒ©ãƒ™ãƒ«</label> <select id="labelEditSelect" style="width:100%;"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option></select></div> <div class="modalField" style="margin-top:16px;"><label for="labelEditNameInput">è¡¨ç¤ºå (ä»»æ„)</label> <input id="labelEditNameInput" type="text" placeholder="ä¾‹: è…•ã®æŒ¯ã‚Š" style="width:100%;"/></div> <div class="noticeActions"><button id="labelEditCancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button id="labelEditOk" class="btn-theme">OK</button></div></div></div> <div id="confirmModal"><div class="noticeCard"><div class="noticeTitle">å‰Šé™¤ç¢ºèª</div> <div id="confirmMessage" class="noticeMessage"></div> <div class="noticeActions"><button id="confirmCancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button id="confirmOk" class="btn-theme">OK</button></div></div></div> <div class="wrap"><h1>ãƒã‚¤ã‚¯ã‚’ä½¿ã£ãŸéŸ³å£°åˆ†é¡ãƒ‡ãƒ¢</h1> <img src="/assets/image-demo1.jpg" width="640" height="360" alt="" style="margin-bottom: 16px;"/> <div class="row" style="align-items:center; gap:16px; margin-bottom:8px;"><div class="muted">ver.260105</div> <div class="modeToggle" role="group" aria-label="è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰"><button type="button" class="modeBtn active" data-mode="basic" aria-pressed="true">Basic</button> <button type="button" class="modeBtn" data-mode="advanced" aria-pressed="false">Advanced</button></div></div> <div class="muted" style="margin-bottom:8px;">ä½¿ã„æ–¹: ãƒã‚¤ã‚¯åˆæœŸåŒ– â–¶ï¸ ãƒ©ãƒ™ãƒ«é¸æŠãƒ¼éŒ²éŸ³å–å¾—é–‹å§‹ï¼ˆè¤‡æ•°å›ï¼‰ â–¶ï¸ å­¦ç¿’ + è©•ä¾¡ â–¶ï¸ æ¨è«–é–‹å§‹</div> <div class="card"><div class="row"><button id="btnInit" class="btn-theme">ãƒã‚¤ã‚¯åˆæœŸåŒ–</button> <span class="pill">ãƒã‚¤ã‚¯æ¥ç¶š: <span id="micStatus" class="muted">No</span></span> <span class="pill mutedText" style="margin-left:auto;">MFCCæ¬¡å…ƒ: 13</span></div> <div class="row" style="margin-top:8px;"><span class="advancedOnly" style="display:inline-flex; align-items:center; gap:8px;"><label for="recSeconds">å–å¾—ç§’æ•°:</label> <input id="recSeconds" type="number" value="2" step="0.5" min="0.5"/></span> <label for="labelInput">ãƒ©ãƒ™ãƒ«:</label> <select id="labelInput"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option></select> <button id="btnRecord" class="btn-theme">éŒ²éŸ³å–å¾—é–‹å§‹</button> <span class="pill">åéŒ²ã‚µãƒ³ãƒ—ãƒ«: <span id="sampleCount">0</span></span></div> <div class="row advancedOnly" style="margin-top:6px; gap:8px; align-items:center; flex-wrap:wrap;"><label for="labelNameInput" class="muted" style="font-size:13px;">ãƒ©ãƒ™ãƒ«è¡¨ç¤ºå:</label> <input id="labelNameInput" type="text" placeholder="ä»»æ„ã®è¡¨ç¤ºå" style="flex:1; min-width:220px;"/> <span class="muted" style="font-size:12px;">æœªå…¥åŠ›æ™‚ã¯ç•ªå·ã®ã¿è¡¨ç¤º</span></div> <div class="row advancedOnly" style="margin-top:8px; align-items:center; gap:8px; flex-wrap:wrap;"><label for="noteInput">ãƒ¡ãƒ¢:</label> <input id="noteInput" type="text" placeholder="ä»»æ„ã®ãƒ¡ãƒ¢" style="flex:1; min-width:320px;"/></div> <div class="row advancedOnly" style="margin-top:8px;"><label for="nRes">ãƒãƒ¼ãƒ‰æ•°</label> <input id="nRes" type="number" step="10" value="300" min="10"/> <label for="spectralRadius">ã‚¹ãƒšã‚¯ãƒˆãƒ«åŠå¾„</label> <input id="spectralRadius" type="number" step="0.05" value="0.90"/> <label for="leakRate">ãƒªãƒ¼ã‚¯ç‡</label> <input id="leakRate" type="number" step="0.05" value="0.80" min="0" max="1"/> <label for="density">çµåˆå¯†åº¦</label> <input id="density" type="number" step="0.05" value="0.10" min="0" max="1"/> <label for="ridgeLambda">ãƒªãƒƒã‚¸Î»</label> <input id="ridgeLambda" type="number" step="0.01" value="0.05" min="0"/></div> <div class="row" style="margin-top:8px;"><span class="advancedOnly" style="display:inline-flex; align-items:center; gap:8px;"><label for="splitRatio" class="splitRatioLabel">train/eval:</label> <select id="splitRatio" class="splitRatio"><option>100:0</option><option>90:10</option><option selected>80:20</option><option>70:30</option></select></span> <button id="btnTrain" class="btn-theme">å­¦ç¿’ï¼‹è©•ä¾¡</button> <span class="pill">å­¦ç¿’æ¸ˆ: <span id="trained" class="muted">No</span></span> <span class="pill">å­¦ç¿’ç²¾åº¦: <span id="evalAccuracy" class="muted">-</span></span></div> <div class="row" style="margin-top:8px;"><span class="advancedOnly" style="display:inline-flex; align-items:center; gap:8px;"><label for="emaAlpha" class="splitRatioLabel">EMA Î±:</label> <input id="emaAlpha" type="number" step="0.05" value="0.10" min="0" max="1" style="width:80px;"/></span> <button id="btnInferStart" class="btn-theme">æ¨è«–é–‹å§‹</button> <button id="btnInferStop">åœæ­¢</button></div> <div class="row" style="margin-top:12px; align-items:flex-end;"><div class="predWrapper"><div id="predLabel" class="predLabel">æ¨è«–äºˆæ¸¬</div> <div id="pred" class="predDisplay">-</div></div></div> <div class="row" style="margin-top:8px;"><span class="pill"><span id="secondaryLabel" class="secondaryLabel">ç¢ºç‡</span>: <span id="secondaryValue" class="secondaryValue mono">-</span></span></div></div> <div class="card advancedOnly"><div class="row"><strong>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</strong> <button id="btnZipAll" class="btn-theme">ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button> <button id="btnFileSelect" class="btn-theme">ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</button> <input id="fileInput" type="file" accept=".zip" multiple style="display:none;"/> <span id="fileStatus" class="muted small">é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</span></div></div> <div class="card advancedOnly"><div class="muted">ãƒ­ã‚°</div> <pre id="log" class="mono" style="white-space: pre-wrap; font-size:.95rem; max-height:260px; overflow:auto;"></pre></div> <div id="sampleList" style="margin-top:8px;"></div></div>',1);function Ln(Ft,Lt){yn(Lt,!1);let D=0,ve=0,ie=0,oe=null,ye=null,$=null,ge=[],et="",q=null,j=null,G=null,he=[];const J=13;let Q=null;function g(...t){if(!Q){console.log(...t);return}Q.textContent+=t.join(" ")+`
`,Q.scrollTop=Q.scrollHeight}function tt(t){return t==null?[]:ArrayBuffer.isView(t)?Array.from(t):Array.isArray(t)&&t.length>0&&Array.isArray(t[0])?t.length===1?t[0].slice():t.reduce((n,a)=>n.concat(a),[]):Array.isArray(t)?t.slice():[t]}function kt(t){const n=tt(t).map(i=>Number.isFinite(i)?i:0);let a=-1/0;for(let i=0;i<n.length;i++)n[i]>a&&(a=n[i]);if(!Number.isFinite(a))return n.map(()=>1/n.length);const o=new Array(n.length);let l=0;for(let i=0;i<n.length;i++){const s=Math.exp(n[i]-a);o[i]=s,l+=s}return(!isFinite(l)||l===0)&&(l=1),o.map(i=>i/l)}function Nt(t,n){const a=new Array(n).fill(0);return a[t]=1,a}function nt(t){const n=t[0].length,a=new Array(n).fill(0),o=new Array(n).fill(0),l=t.length;for(const i of t)for(let s=0;s<n;s++)a[s]+=i[s];for(let i=0;i<n;i++)a[i]/=l;for(const i of t)for(let s=0;s<n;s++){const p=i[s]-a[s];o[s]+=p*p}for(let i=0;i<n;i++)o[i]=Math.sqrt(o[i]/Math.max(1,l-1))||1;return{mu:a,sig:o}}function se(t,n,a){const o=new Array(t.length);for(let l=0;l<t.length;l++)o[l]=(t[l]-n[l])/(a[l]||1);return o}function at(t,n){const a=t.length,o=new ArrayBuffer(44+2*a),l=new DataView(o);let i=0;const s=r=>{for(let d=0;d<r.length;d++)l.setUint8(i++,r.charCodeAt(d))},p=r=>{l.setUint32(i,r,!0),i+=4},u=r=>{l.setUint16(i,r,!0),i+=2};s("RIFF"),p(36+2*a),s("WAVE"),s("fmt "),p(16),u(1),u(1),p(n),p(n*2),u(2),u(16),s("data"),p(2*a);let c=44;for(let r=0;r<a;r++){let d=Math.max(-1,Math.min(1,t[r]));l.setInt16(c,d<0?d*32768:d*32767,!0),c+=2}return new Blob([l],{type:"audio/wav"})}function re(t=new Date){const n=(a,o=2)=>String(a).padStart(o,"0");return`${t.getFullYear()}${n(t.getMonth()+1)}${n(t.getDate())}-${n(t.getHours())}${n(t.getMinutes())}${n(t.getSeconds())}`}function Bt(t,n,a=40,o){if(!n)return 0;const l=new Float32Array(n);let i=0;for(let u=0;u<n;u++){const r=(o?o():Math.random())*2-1;l[u]=r,i+=r*r}(!isFinite(i)||i===0)&&(l.fill(0),l[0]=1,i=1),i=Math.sqrt(i);for(let u=0;u<n;u++)l[u]/=i;const s=new Float32Array(n);let p=0;for(let u=0;u<a;u++){for(let r=0;r<n;r++){let d=0;const m=r*n;for(let E=0;E<n;E++)d+=t[m+E]*l[E];s[r]=d}let c=0;for(let r=0;r<n;r++)c+=s[r]*s[r];if(c=Math.sqrt(c),!isFinite(c)||c===0){p=0;break}for(let r=0;r<n;r++)l[r]=s[r]/c;p=c}return p}class lt{constructor(n,a,o,{spectralRadius:l=.9,density:i=.1,leak:s=.5,seed:p=0}={}){this.nIn=n,this.nRes=a,this.nOut=o,this.leak=s,this.seed=p|0;const u=this._rng();this.W_in=new Float32Array(a*n);for(let m=0;m<this.W_in.length;m++)this.W_in[m]=(u()*2-1)*.5;this.W_res=new Float32Array(a*a);for(let m=0;m<a;m++){const E=m*a;for(let N=0;N<a;N++){const _=u();this.W_res[E+N]=_<i?u()*2-1:0}}const c=Math.abs(l),r=Bt(this.W_res,a,40,u),d=r>0?c/r:c;for(let m=0;m<this.W_res.length;m++)this.W_res[m]*=d;this.x=new Float32Array(a),this.W_out=null}_rng(){let n=this.seed>>>0||1;return()=>(n=n*1664525+1013904223>>>0,(n&65535)/65535)}reset(){this.x.fill(0)}step(n){const a=this.nRes,o=this.nIn,l=this.leak,i=new Float32Array(a);for(let s=0;s<a;s++){let p=0,u=s*o,c=s*a;for(let r=0;r<o;r++)p+=this.W_in[u+r]*n[r];for(let r=0;r<a;r++)p+=this.W_res[c+r]*this.x[r];i[s]=Math.tanh(p)}for(let s=0;s<a;s++)this.x[s]=(1-l)*this.x[s]+l*i[s];return this.x}fit(n,a,o,l=.01){this.reset();const i=n.length,s=new Array(i),p=new Array(i);for(let v=0;v<i;v++){const M=this.step(n[v]),h=new Array(1+this.nRes);h[0]=1;for(let x=0;x<this.nRes;x++)h[1+x]=M[x];s[v]=h,p[v]=Nt(a[v],o)}const u=s[0].length;let c,r,d;if(i>=u){const v=numeric.svd(s);c=v.S.slice();const M=c.length;r=v.U.map(h=>h.slice(0,M)),d=v.V.map(h=>h.slice(0,M))}else{const v=numeric.transpose(s),M=numeric.svd(v);c=M.S.slice();const h=c.length;d=M.U.map(x=>x.slice(0,h)),r=M.V.map(x=>x.slice(0,h))}c.length;const m=c.map(v=>v/(v*v+l)),E=numeric.dot(numeric.transpose(r),p),N=d.map(v=>v.map((M,h)=>M*m[h]));let _=numeric.dot(N,E);const R=v=>v.flat().every(Number.isFinite);if(!R(_)){const v=c.map(h=>h/(h*h+l*10)),M=d.map(h=>h.map((x,B)=>x*v[B]));if(_=numeric.dot(M,E),!R(_))throw new Error("W_out is non-finite even after retry")}this.W_out=_}predictFrame(n){const a=this.step(n);if(!this.W_out)return{z:new Array(this.nOut).fill(0),p:new Array(this.nOut).fill(0)};const o=[1,...a],l=tt(numeric.dot(o,this.W_out));if(l.some(s=>!Number.isFinite(s)))return{z:l,p:new Array(this.nOut).fill(1/this.nOut)};const i=kt(l);return i.some(s=>!Number.isFinite(s))?{z:l,p:new Array(this.nOut).fill(1/this.nOut)}:{z:l,p:i}}}let T=null,Ie=null,it=null,ce=!1,W=!1,de=!1,Ee=!1;const b=[];let X=[],P=null,ee=[],Z=null,L=null;const xe=new Map;let ue=null,ot=0;const k={};let te=null,we=null;const e={labelInput:null,recSeconds:null,btnInit:null,btnRecord:null,btnTrain:null,btnInferStart:null,btnInferStop:null,sampleCount:null,trained:null,predLabel:null,pred:null,secondaryLabel:null,secondaryValue:null,spectralRadius:null,leakRate:null,nRes:null,density:null,ridgeLambda:null,overlay:null,overlayMsg:null,splitRatio:null,emaAlpha:null,btnZipAll:null,btnFileSelect:null,fileInput:null,fileStatus:null,labelNameInput:null,noteInput:null,micStatus:null,noticeModal:null,noticeMessage:null,noticeClose:null,labelModal:null,labelEditSelect:null,labelEditNameInput:null,labelEditCancel:null,labelEditOk:null,labelEditMessage:null,confirmModal:null,confirmMessage:null,confirmCancel:null,confirmOk:null,modeButtons:null};function $t(){e.labelInput=document.getElementById("labelInput"),e.recSeconds=document.getElementById("recSeconds"),e.btnInit=document.getElementById("btnInit"),e.btnRecord=document.getElementById("btnRecord"),e.btnTrain=document.getElementById("btnTrain"),e.btnInferStart=document.getElementById("btnInferStart"),e.btnInferStop=document.getElementById("btnInferStop"),e.sampleCount=document.getElementById("sampleCount"),e.trained=document.getElementById("trained"),e.predLabel=document.getElementById("predLabel"),e.pred=document.getElementById("pred"),e.secondaryLabel=document.getElementById("secondaryLabel"),e.secondaryValue=document.getElementById("secondaryValue"),e.spectralRadius=document.getElementById("spectralRadius"),e.leakRate=document.getElementById("leakRate"),e.nRes=document.getElementById("nRes"),e.density=document.getElementById("density"),e.ridgeLambda=document.getElementById("ridgeLambda"),e.overlay=document.getElementById("overlay"),e.overlayMsg=document.getElementById("overlayMsg"),e.splitRatio=document.getElementById("splitRatio"),e.emaAlpha=document.getElementById("emaAlpha"),e.btnZipAll=document.getElementById("btnZipAll"),e.btnFileSelect=document.getElementById("btnFileSelect"),e.fileInput=document.getElementById("fileInput"),e.fileStatus=document.getElementById("fileStatus"),e.labelNameInput=document.getElementById("labelNameInput"),e.noteInput=document.getElementById("noteInput"),e.micStatus=document.getElementById("micStatus"),e.noticeModal=document.getElementById("noticeModal"),e.noticeMessage=document.getElementById("noticeMessage"),e.noticeClose=document.getElementById("noticeClose"),e.labelModal=document.getElementById("labelModal"),e.labelEditSelect=document.getElementById("labelEditSelect"),e.labelEditNameInput=document.getElementById("labelEditNameInput"),e.labelEditCancel=document.getElementById("labelEditCancel"),e.labelEditOk=document.getElementById("labelEditOk"),e.labelEditMessage=document.getElementById("labelEditMessage"),e.confirmModal=document.getElementById("confirmModal"),e.confirmMessage=document.getElementById("confirmMessage"),e.confirmCancel=document.getElementById("confirmCancel"),e.confirmOk=document.getElementById("confirmOk"),e.modeButtons=document.querySelectorAll(".modeToggle button")}function ne(t,n){e.predLabel&&(e.predLabel.textContent=t),e.pred&&(e.pred.textContent=n)}function ae(t,n){e.secondaryLabel&&(e.secondaryLabel.textContent=t),e.secondaryValue&&(e.secondaryValue.textContent=n)}function pe(){ne("ã‚«ã‚¦ãƒ³ã‚¿","-"),ae("è¨˜éŒ²","-")}pe();function st(){ue&&(clearInterval(ue),ue=null)}function Ot(t="processing..."){e.overlayMsg&&(e.overlayMsg.textContent=t),e.overlay&&(e.overlay.style.display="flex")}function Tt(){e.overlay&&(e.overlay.style.display="none")}function jt(){return new Promise(t=>requestAnimationFrame(()=>t()))}function U(t){const n=k[t];return n&&n.trim()?`${t}:${n.trim()}`:String(t)}function Me(t,n,{allowEmptyClear:a=!1}={}){const o=Number.isFinite(t)?t:parseInt(t,10);if(!Number.isFinite(o))return!1;const l=(n||"").trim(),i=k[o];return l?i===l?!1:(k[o]=l,!0):!a||!i?!1:(delete k[o],!0)}function le(){const t=e.labelInput;t&&Array.from(t.options||[]).forEach(n=>{const a=parseInt(n.value,10);isNaN(a)||(n.textContent=U(a))})}function Se(){if(!e.labelNameInput||!e.labelInput)return;const t=parseInt(e.labelInput.value,10)||0;e.labelNameInput.value=k[t]||""}function Ut(){if(!e.labelInput)return;const t=parseInt(e.labelInput.value,10)||0,n=e.labelNameInput?e.labelNameInput.value:"";Me(t,n,{allowEmptyClear:!0})&&(le(),V(),O())}function V(){const t=e.labelEditSelect;t&&Array.from(t.options||[]).forEach(n=>{const a=parseInt(n.value,10);isNaN(a)||(n.textContent=U(a))})}function rt(t){if(!e.labelModal||!(t>=0&&t<b.length))return;te=t;const n=b[t];e.labelEditMessage&&(e.labelEditMessage.textContent=`ã‚µãƒ³ãƒ—ãƒ« #${t+1} / frames=${n.frames.length}`),e.labelEditSelect&&(e.labelEditSelect.value=String(n.label)),ct(),V(),e.labelModal.style.display="flex"}function me(){te=null,e.labelModal&&(e.labelModal.style.display="none")}function ct(){if(!e.labelEditSelect||!e.labelEditNameInput)return;const t=parseInt(e.labelEditSelect.value,10)||0;e.labelEditNameInput.value=k[t]||""}function zt(){if(!(te>=0&&te<b.length)){me();return}const t=b[te],n=parseInt(e.labelEditSelect&&e.labelEditSelect.value,10)||0;t.label=n,e.labelEditNameInput&&Me(n,e.labelEditNameInput.value,{allowEmptyClear:!0}),le(),V(),O(),me()}function Dt(t){t>=0&&t<b.length&&Pt(`ã‚µãƒ³ãƒ—ãƒ« #${t+1} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`,()=>Wt(t))}function Wt(t){if(!(t>=0&&t<b.length))return;const n=b[t];if(n&&n.audioUrl)try{URL.revokeObjectURL(n.audioUrl)}catch{}b.splice(t,1),e.sampleCount.textContent=String(b.length),b.length===0&&e.sampleCount.classList.remove("okText"),O()}function Pt(t,n){we=typeof n=="function"?n:null,e.confirmMessage&&(e.confirmMessage.textContent=t),e.confirmModal&&(e.confirmModal.style.display="flex")}function _e(){we=null,e.confirmModal&&(e.confirmModal.style.display="none")}function w(t){e.noticeMessage&&(e.noticeMessage.textContent=t),e.noticeModal?(e.noticeModal.style.display="flex",e.noticeClose&&e.noticeClose.focus()):alert(t)}function dt(){e.noticeModal&&(e.noticeModal.style.display="none")}function H(t,n={}){const{checkInfer:a=!0,checkTrain:o=!0,checkRecord:l=!0}=n;return a&&de?(w(`æ¨è«–ä¸­ã¯${t}ã§ãã¾ã›ã‚“ã€‚æ¨è«–ã‚’åœæ­¢ã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚`),!0):o&&Ee?(w(`å­¦ç¿’ä¸­ã¯${t}ã§ãã¾ã›ã‚“ã€‚å®Œäº†ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚`),!0):l&&W?(w(`éŒ²éŸ³ä¸­ã¯${t}ã§ãã¾ã›ã‚“ã€‚éŒ²éŸ³ã‚’åœæ­¢ã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚`),!0):!1}function ut(t){const n=t==="advanced"?"mode-advanced":"mode-basic";document.body.classList.remove("mode-basic","mode-advanced"),document.body.classList.add(n),e.modeButtons&&e.modeButtons.forEach(a=>{const o=a.dataset.mode===(t==="advanced"?"advanced":"basic");a.classList.toggle("active",o),a.setAttribute("aria-pressed",o?"true":"false")})}function pt(){const t=(()=>{const i=parseFloat(e.spectralRadius&&e.spectralRadius.value);return Number.isFinite(i)?Math.max(.01,i):.9})(),n=(()=>{const i=parseFloat(e.leakRate&&e.leakRate.value);return Number.isFinite(i)?Math.min(1,Math.max(0,i)):.8})(),a=(()=>{const i=parseInt(e.nRes&&e.nRes.value,10);return Number.isFinite(i)&&i>0?Math.max(10,i):300})(),o=(()=>{const i=parseFloat(e.density&&e.density.value);return Number.isFinite(i)?Math.min(1,Math.max(.01,i)):.1})(),l=(()=>{const i=parseFloat(e.ridgeLambda&&e.ridgeLambda.value);return Number.isFinite(i)&&i>0?i:.05})();return e.spectralRadius&&(e.spectralRadius.value=t.toFixed(2)),e.leakRate&&(e.leakRate.value=n.toFixed(2)),e.nRes&&(e.nRes.value=String(a)),e.density&&(e.density.value=o.toFixed(2)),e.ridgeLambda&&(e.ridgeLambda.value=l.toFixed(2)),{spectralRadius:t,leakRate:n,nRes:a,density:o,ridgeLambda:l}}function Zt(){const t=(()=>{const a=parseFloat(e.splitRatio&&e.splitRatio.value);return Number.isFinite(a)?a:.8})(),n=Math.min(Math.max(t,.5),1);return e.splitRatio&&(e.splitRatio.value=n.toFixed(1)),{trainRatio:n,evalRatio:Math.max(0,1-n)}}function Vt(){const t=parseFloat(e.emaAlpha&&e.emaAlpha.value),n=Number.isFinite(t)?Math.min(Math.max(t,.01),1):.1;return e.emaAlpha&&(e.emaAlpha.value=n.toFixed(2)),n}function Ht(){try{for(const t of b)if(t&&t.audioUrl)try{URL.revokeObjectURL(t.audioUrl)}catch{}}catch{}b.length=0,xe.clear(),e.sampleCount.textContent="0",e.sampleCount.classList.remove("okText"),O(),g("ğŸ§¹ æ—¢å­˜ã‚µãƒ³ãƒ—ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")}async function Kt(){if(ce)return;const t=await navigator.mediaDevices.getUserMedia({audio:!0});ye=t,T=new(window.AudioContext||window.webkitAudioContext)({sampleRate:22050}),Ie=T.createMediaStreamSource(t),it=Meyda.createMeydaAnalyzer({audioContext:T,source:Ie,bufferSize:1024,featureExtractors:["mfcc"],numberOfMFCCCoefficients:J,callback:n=>{if(!n||!n.mfcc)return;const a=n.mfcc;W&&X.push(a.slice()),de&&an(a)}}),it.start(),ce=!0,g("âœ… ãƒã‚¤ã‚¯åˆæœŸåŒ–å®Œäº† / ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ:",T.sampleRate),e.micStatus&&(e.micStatus.textContent="Yes",e.micStatus.classList.remove("muted"),e.micStatus.classList.add("okText"))}function Yt(){if(j){try{j.disconnect()}catch{}j=null}G||(G=T.createGain(),G.gain.value=0,G.connect(T.destination)),j=T.createScriptProcessor(2048,1,1),j.onaudioprocess=t=>{if(!W)return;const n=t.inputBuffer.getChannelData(0);he.push(new Float32Array(n))},Ie.connect(j),j.connect(G)}function qt(t){const n=t.reduce((l,i)=>l+i.length,0),a=new Float32Array(n);let o=0;for(const l of t)a.set(l,o),o+=l.length;return a}async function Gt(){if(H("éŒ²éŸ³å–å¾—",{checkRecord:!1}))return;if(!ce){g("âš ï¸ å…ˆã«ãƒã‚¤ã‚¯åˆæœŸåŒ–ã‚’æŠ¼ã—ã¦ãã ã•ã„"),w("å…ˆã«ã€Œãƒã‚¤ã‚¯åˆæœŸåŒ–ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");return}if(W){g("â€¦éŒ²éŸ³ä¸­ã§ã™"),w("éŒ²éŸ³ä¸­ã§ã™ã€‚åœæ­¢ã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚");return}let t=parseFloat(e.recSeconds.value);(!Number.isFinite(t)||t<=0)&&(t=2,e.recSeconds&&(e.recSeconds.value=String(t)));const n=parseInt(e.labelInput.value,10)|0;let a=3;ne("ã‚«ã‚¦ãƒ³ã‚¿",String(a)),ae("è¨˜éŒ²","-");const o=setInterval(()=>{a--,ne("ã‚«ã‚¦ãƒ³ã‚¿",a>0?String(a):"REC"),a<=0&&(clearInterval(o),Jt(t,n))},800)}function Jt(t,n){X=[],he=[],Yt(),W=!0,e.labelNameInput&&Me(n,e.labelNameInput.value,{allowEmptyClear:!0})&&(le(),V()),st(),ot=performance.now(),ne("ã‚«ã‚¦ãƒ³ã‚¿","REC"),ae("è¨˜éŒ²","0.0s"),ue=setInterval(()=>{const l=Math.min(t,(performance.now()-ot)/1e3);ae("è¨˜éŒ²",`${l.toFixed(1)}s`)},100),g(`â— éŒ²éŸ³é–‹å§‹ï¼ˆ${t.toFixed(1)}ç§’ï¼‰, ãƒ©ãƒ™ãƒ«=${U(n)}`),ge=[];const a=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg"];let o="";for(const l of a)if(window.MediaRecorder&&MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported(l)){o=l;break}if(et=o||"",ye&&window.MediaRecorder)try{$=new MediaRecorder(ye,o?{mimeType:o}:void 0),$.ondataavailable=l=>{l.data&&l.data.size>0&&ge.push(l.data)}}catch(l){console.warn("MediaRecorder init failed:",l),$=null}$&&$.start(),setTimeout(()=>Xt(n),t*1e3)}function Qt(t){const n=(xe.get(t)|0)+1;return xe.set(t,n),n}function Xt(t){if(W=!1,st(),pe(),X.length<4){g("âš ï¸ ãƒ•ãƒ¬ãƒ¼ãƒ ãŒå°‘ãªã™ãã¦ç ´æ£„ï¼ˆé›‘éŸ³/ç„¡éŸ³ã®å¯èƒ½æ€§ï¼‰"),w("éŒ²éŸ³ãŒçŸ­ã™ããŸãŸã‚ç ´æ£„ã—ã¾ã—ãŸã€‚å†åº¦éŒ²éŸ³ã—ã¦ãã ã•ã„ã€‚");return}let n=null,a=null,o=null;try{const l=qt(he);n=at(l,T.sampleRate),a=URL.createObjectURL(n);const i=Qt(t);o=`${t}-${String(i).padStart(3,"0")}_${re()}.wav`}catch(l){console.warn("WAVç”Ÿæˆå¤±æ•—:",l)}if(q={label:t,frames:X.map(l=>l.slice()),audioUrl:a||null,wavBlob:n||null,filename:o},b.push(q),e.sampleCount.textContent=String(b.length),b.length>0&&e.sampleCount.classList.add("okText"),g(`â–  ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ : label=${U(t)} frames=${X.length} ${o?" file="+o:""}`),$){$.onstop=()=>{try{if(!n){const l=new Blob(ge,{type:et||"audio/webm"}),i=URL.createObjectURL(l);q&&!q.audioUrl&&(q.audioUrl=i)}O()}catch(l){console.warn("blobä½œæˆå¤±æ•—:",l),O()}$=null};try{$.stop()}catch(l){console.warn("MediaRecorder stopå¤±æ•—:",l),O()}}else O()}function O(){const t=document.getElementById("sampleList");if(t){if(t.innerHTML="",!b.length){const n=document.createElement("div");n.className="muted small",n.textContent="(ã‚µãƒ³ãƒ—ãƒ«ãªã—)",t.appendChild(n);return}b.forEach((n,a)=>{const o=document.createElement("div");o.className="sampleRow";const l=document.createElement("div");l.className="sampleHeader";const i=document.createElement("span");i.textContent=`#${a+1}`,l.appendChild(i);const s=document.createElement("a");s.href="#",s.className="labelLink",s.textContent=`label=${U(n.label)}`,s.addEventListener("click",m=>{m.preventDefault(),rt(a)}),l.appendChild(s);const p=document.createElement("span");p.textContent=`frames=${n.frames.length}`,l.appendChild(p),o.appendChild(l);const u=document.createElement("div");if(u.className="sampleAudio",n.audioUrl){const m=document.createElement("audio");m.controls=!0,m.src=n.audioUrl,u.appendChild(m)}else{const m=document.createElement("span");m.className="muted",m.textContent="(éŸ³å£°æº–å‚™ä¸­)",u.appendChild(m)}o.appendChild(u);const c=document.createElement("div");c.className="sampleActions";const r=document.createElement("button");r.textContent="ãƒ©ãƒ™ãƒ«ç·¨é›†",r.addEventListener("click",()=>rt(a)),c.appendChild(r);const d=document.createElement("button");d.textContent="å‰Šé™¤",d.addEventListener("click",()=>Dt(a)),c.appendChild(d),o.appendChild(c),t.appendChild(o)})}}async function en(){if(H("å­¦ç¿’ï¼‹è©•ä¾¡"))return;if(b.length<2){g("âš ï¸ ã‚µãƒ³ãƒ—ãƒ«ãŒå°‘ãªã™ãã¾ã™ï¼ˆæœ€ä½2ï¼‰"),w("å­¦ç¿’ã«ã¯æœ€ä½2ã‚µãƒ³ãƒ—ãƒ«å¿…è¦ã§ã™ã€‚");return}Ee=!0,Ot(`å­¦ç¿’ï¼‹è©•ä¾¡ä¸­...

ã€Œãƒšãƒ¼ã‚¸ãŒå¿œç­”ã—ã¾ã›ã‚“ã€ã¨å‡ºãŸå ´åˆã¯ã€ãã®ã¾ã¾å¾…ã¤ã‹ã€Œå¾…æ©Ÿã€ã‚’æŠ¼ã—ã¦ãã ã•ã„`),await jt(),await new Promise(d=>setTimeout(d,0)),ee=[...new Set(b.map(d=>d.label))].sort((d,m)=>d-m);const t=ee.length,n=J,a=[],o=[];for(const d of b){const m=ee.indexOf(d.label);for(const E of d.frames)a.push(E.slice(0,n)),o.push(m)}P=nt(a);const l=a.map(d=>se(d,P.mu,P.sig)),i=pt(),s=Math.max(1e-6,i.ridgeLambda),{trainRatio:p,evalRatio:u}=Zt(),c=n,r=t;try{Z=new lt(c,i.nRes,r,{spectralRadius:i.spectralRadius,density:i.density,leak:i.leakRate,seed:42}),Z.fit(l,o,t,s),e.trained.textContent="Yes",e.trained.classList.remove("muted"),e.trained.classList.add("ok");const d=ee.map(U).join(",");g(`âœ… å­¦ç¿’å®Œäº†ï¼šã‚¯ãƒ©ã‚¹=${d}, nRes=${i.nRes}, Ï=${i.spectralRadius.toFixed(2)}, leak=${i.leakRate.toFixed(2)}, çµåˆå¯†åº¦=${i.density.toFixed(2)}, ridge=${s.toFixed(3)}, split=${Math.round(p*100)}:${Math.round(u*100)}, ãƒ•ãƒ¬ãƒ¼ãƒ æ•°=${l.length}`),ln(u,123)}catch(d){g(`âš ï¸ å­¦ç¿’ä¸­ã«ã‚¨ãƒ©ãƒ¼: ${d&&d.message?d.message:d}`)}finally{Tt(),Ee=!1}}function tn(){if(!H("æ¨è«–",{checkInfer:!1})){if(!ce){w("å…ˆã«ã€Œãƒã‚¤ã‚¯åˆæœŸåŒ–ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");return}if(!Z||!Z.W_out){g("âš ï¸ å…ˆã«å­¦ç¿’ã—ã¦ãã ã•ã„"),w("æ¨è«–å‰ã«å­¦ç¿’ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚");return}Z.reset(),L=null,de=!0,g("â–¶ æ¨è«–é–‹å§‹"),D=0,ve=performance.now(),ie=ve,oe=null,pe()}}function nn(){de=!1,g("â–  æ¨è«–åœæ­¢");const t=(performance.now()-ve)/1e3;t>0&&console.log("[infer] stop",{frames:D,fps:(D/t).toFixed(1)}),pe()}function an(t){const n=J;if(!P)return;const a=se(t.slice(0,n),P.mu,P.sig),{p:o}=Z.predictFrame(a);if(!o||o.some(c=>!Number.isFinite(c)))return;const l=Vt();if(!L)L=o.slice();else for(let c=0;c<o.length;c++)L[c]=(1-l)*L[c]+l*o[c];const i="["+L.map(c=>c.toFixed(2)).join(", ")+"]",s=mt(L),p=ee[s];ne("æ¨è«–äºˆæ¸¬",U(p)),ae("ç¢ºç‡",i),D++,p!==oe&&(console.log("[infer] pred change",{frame:D,from:oe,to:p,p:+L[s].toFixed(3),probs:L.map(c=>+c.toFixed(2))}),oe=p);const u=performance.now();if(u-ie>=1e3){const c=(u-ie)/1e3;console.log("[infer] tick",{frame:D,approxFps:(10/c).toFixed(1),top:{label:p,p:+L[s].toFixed(2)}}),ie=u}}function mt(t){let n=0,a=-1e9;for(let o=0;o<t.length;o++)t[o]>a&&(a=t[o],n=o);return n}function ln(t=.2,n=123){if(b.length<4){g("âš ï¸ ã‚µãƒ³ãƒ—ãƒ«ãŒå°‘ãªã™ãã¾ã™ï¼ˆæœ€ä½4æ¨å¥¨ï¼‰"),w("è©•ä¾¡ã«ã¯æœ€ä½4ã‚µãƒ³ãƒ—ãƒ«æ¨å¥¨ã§ã™ã€‚");return}const a=b.map(f=>f.label),o=[...new Set(a)].sort((f,I)=>f-I),l=o.length;if(l<2){g("âš ï¸ ã‚¯ãƒ©ã‚¹ãŒ1ç¨®é¡ã—ã‹ã‚ã‚Šã¾ã›ã‚“"),w("è©•ä¾¡ã«ã¯2ç¨®é¡ä»¥ä¸Šã®ãƒ©ãƒ™ãƒ«ãŒå¿…è¦ã§ã™ã€‚");return}const s=(f=>()=>(f=f*1664525+1013904223>>>0,(f>>>0)/4294967296))(n),p=new Map;o.forEach(f=>p.set(f,[])),b.forEach((f,I)=>p.get(f.label).push(I));const u=[],c=[];for(const f of o){const I=p.get(f).slice();for(let S=I.length-1;S>0;S--){const be=Math.floor(s()*(S+1));[I[S],I[be]]=[I[be],I[S]]}if(I.length<2){u.push(...I);continue}let C=Math.max(1,Math.floor(I.length*t));C=Math.min(C,I.length-1),c.push(...I.slice(0,C)),u.push(...I.slice(C))}const r=u.map(f=>b[f]),d=c.map(f=>b[f]),m=J,E=[],N=[];for(const f of r){const I=o.indexOf(f.label);for(const C of f.frames)E.push(C.slice(0,m)),N.push(I)}if(E.length<10){g("âš ï¸ å­¦ç¿’ãƒ•ãƒ¬ãƒ¼ãƒ ãŒå°‘ãªã™ãã¾ã™"),w("è©•ä¾¡ç”¨ã«ååˆ†ãªãƒ•ãƒ¬ãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã‚µãƒ³ãƒ—ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");return}const _=nt(E),R=E.map(f=>se(f,_.mu,_.sig)),v=pt(),M=Math.max(1e-6,v.ridgeLambda),h=new lt(m,v.nRes,l,{spectralRadius:v.spectralRadius,density:v.density,leak:v.leakRate,seed:42});try{h.fit(R,N,l,M)}catch{g("âš ï¸ å­¦ç¿’ãŒä¸å®‰å®šã§ã™ï¼ˆridgeã‚’ä¸Šã’ã‚‹ãƒ»ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’å¢—ã‚„ã™ï¼‰");return}const x=Array.from({length:l},()=>Array(l).fill(0));let B=0,z=0;for(const f of d){const I=o.indexOf(f.label);h.reset();let C=new Array(l).fill(0),S=0;for(const Qe of f.frames){const fn=se(Qe.slice(0,m),_.mu,_.sig),{p:Xe}=h.predictFrame(fn);if(!(!Xe||Xe.some(K=>!Number.isFinite(K)))){for(let K=0;K<l;K++)C[K]+=Xe[K];S++}}if(S===0)continue;const be=C.map(Qe=>Qe/S),Ct=mt(be);x[I][Ct]++,z++,Ct===I&&B++}const Ge=z>0?B/z:0,dn=Math.round((1-t)*100),un=Math.round(t*100);g(`âœ… è©•ä¾¡å®Œäº†: accuracy=${(Ge*100).toFixed(1)}%  testã‚µãƒ³ãƒ—ãƒ«=${z} split=${dn}:${un}`);const pn=z>0?`${(Ge*100).toFixed(1)}%`:"-",fe=document.getElementById("evalAccuracy");fe&&(fe.textContent=pn,z>0?fe.classList.add("okText"):fe.classList.remove("okText"));let Je=`Confusion Matrix [true x pred]
`;Je+="      "+o.map(f=>String(f).padStart(4," ")).join("")+`
`;for(let f=0;f<l;f++)Je+=String(o[f]).padStart(4," ")+" "+x[f].map(I=>String(I).padStart(4," ")).join("")+`
`;g(Je.trim());const mn=x.map((f,I)=>{const C={true:o[I]};for(let S=0;S<l;S++)C["pred_"+o[S]]=f[S];return C});console.log("[eval] accuracy=",Ge.toFixed(3)," total=",z),console.table(mn)}async function on(){if(H("ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"))return;if(!b.length){g("âš ï¸ ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“");return}const t=new JSZip;let n=0;const a=[];for(const c of b){let r=c.wavBlob,d=c.filename;if(!r)try{const N=await(await fetch(c.audioUrl)).arrayBuffer(),R=await new(window.AudioContext||window.webkitAudioContext)().decodeAudioData(N),v=R.numberOfChannels>1?(()=>{const M=R.getChannelData(0),h=R.getChannelData(1),x=new Float32Array(R.length);for(let B=0;B<x.length;B++)x[B]=(M[B]+h[B])/2;return x})():R.getChannelData(0);r=at(new Float32Array(v),R.sampleRate),d=d||`label-${String(c.label)}_${re()}.wav`}catch(E){console.warn("WAVå†ç”Ÿæˆå¤±æ•—:",E);continue}const m=d||`label-${String(c.label)}_${re()}.wav`;t.file(m,r),a.push({label:c.label,filename:m,frames:c.frames}),n++}const o={};Object.entries(k).forEach(([c,r])=>{const d=(r||"").trim();d&&(o[c]=d)});const l=e.noteInput&&e.noteInput.value||"",i={version:"251123",mfccDim:J,note:l,labelNames:o,samples:a};t.file("metadata.json",JSON.stringify(i,null,2));const s=`${re()}_dataset_audio.zip`,p=await t.generateAsync({type:"blob"}),u=document.createElement("a");u.href=URL.createObjectURL(p),u.download=s,u.click(),g(`âœ… ZIPä½œæˆ: ${s} ï¼ˆ${n} ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰`)}async function sn(t){if(!t.length){g("âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“");return}const n=t.filter(a=>/\.zip$/i.test(a.name));if(!n.length){g("âš ï¸ ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„"),w("ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");return}await cn(n[0])}function rn(){e.btnInit&&(e.btnInit.onclick=Kt),e.btnRecord&&(e.btnRecord.onclick=Gt),e.btnTrain&&(e.btnTrain.onclick=en),e.btnInferStart&&(e.btnInferStart.onclick=tn),e.btnInferStop&&(e.btnInferStop.onclick=nn),e.btnZipAll&&(e.btnZipAll.onclick=on),e.btnFileSelect&&e.fileInput&&(e.btnFileSelect.onclick=()=>{H("ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ",{checkRecord:!1})||e.fileInput.click()}),e.fileInput&&e.fileInput.addEventListener("change",async()=>{if(H("ZIPã‚¤ãƒ³ãƒãƒ¼ãƒˆ")){e.fileInput.value="";return}const t=Array.from(e.fileInput.files||[]);t.length&&(e.fileStatus&&(e.fileStatus.textContent=t[0].name),await sn(t),e.fileInput.value="")}),e.labelNameInput&&e.labelNameInput.addEventListener("change",Ut),e.labelInput&&e.labelInput.addEventListener("change",()=>Se()),Se(),e.labelModal&&e.labelModal.addEventListener("click",t=>{t.target===e.labelModal&&me()}),e.labelEditCancel&&e.labelEditCancel.addEventListener("click",me),e.labelEditOk&&e.labelEditOk.addEventListener("click",zt),e.labelEditSelect&&e.labelEditSelect.addEventListener("change",ct),e.confirmModal&&e.confirmModal.addEventListener("click",t=>{t.target===e.confirmModal&&_e()}),e.confirmCancel&&e.confirmCancel.addEventListener("click",_e),e.confirmOk&&e.confirmOk.addEventListener("click",()=>{const t=we;_e(),typeof t=="function"&&t()}),le(),V(),e.noticeModal&&e.noticeModal.addEventListener("click",t=>{t.target===e.noticeModal&&dt()}),e.noticeClose&&e.noticeClose.addEventListener("click",dt),e.modeButtons&&typeof e.modeButtons.forEach=="function"&&e.modeButtons.forEach(t=>{t.addEventListener("click",()=>{ut(t.dataset.mode==="advanced"?"advanced":"basic")})}),ut("basic")}async function cn(t){try{const n=await JSZip.loadAsync(t),a=n.file("metadata.json");if(!a){g("âš ï¸ ZIPå†…ã«metadata.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),w("ZIPå†…ã«metadata.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");return}const o=JSON.parse(await a.async("string")),l=Array.isArray(o?.samples)?o.samples:Array.isArray(o)?o:[];if(!l.length){g("âš ï¸ metadata.jsonã«ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“"),w("ZIPå†…ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");return}Ht(),Object.keys(k).forEach(s=>delete k[s]),o.labelNames&&typeof o.labelNames=="object"&&Object.entries(o.labelNames).forEach(([s,p])=>{const u=parseInt(s,10);!isNaN(u)&&typeof p=="string"&&p.trim()&&(k[u]=p.trim())}),e.noteInput&&(e.noteInput.value=o.note||""),le(),V(),Se();let i=0;for(const s of l){if(!s)continue;const p=typeof s.label=="number"?s.label:parseInt(s.label,10)||0,u=s.filename||`label-${p}_${String(i+1).padStart(3,"0")}.wav`;let c=null,r=null;const d=n.file(u);if(d){const E=await d.async("arraybuffer");c=new Blob([E],{type:"audio/wav"}),r=URL.createObjectURL(c)}const m=Array.isArray(s.frames)?s.frames:[];b.push({label:p,frames:m,audioUrl:r,wavBlob:c,filename:u}),i++}e.sampleCount.textContent=String(b.length),b.length>0&&e.sampleCount.classList.add("okText"),O(),g(`âœ… ZIPã‹ã‚‰å–è¾¼å®Œäº†: ${i} ä»¶`)}catch(n){console.error("zip import failed",n),g(`âš ï¸ ZIPå–è¾¼å¤±æ•—: ${n&&n.message?n.message:n}`),w(`ZIPã®å–ã‚Šè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${n&&n.message?n.message:n}`)}}bn(()=>{Q=document.getElementById("log"),$t(),rn()}),vn(()=>{typeof document<"u"&&document.body.classList.remove("mode-basic","mode-advanced")}),xn();var ft=Mn();En("6ufjw1",t=>{var n=wn();Y(4),Rt(t,n)});var Ce=y(gn(ft),4),bt=A(Ce),vt=y(A(bt),4),yt=y(A(vt),2),Re=A(yt);Re.value=Re.__value="0";var Ae=y(Re);Ae.value=Ae.__value="1";var Fe=y(Ae);Fe.value=Fe.__value="2";var Le=y(Fe);Le.value=Le.__value="3";var ke=y(Le);ke.value=ke.__value="4";var Ne=y(ke);Ne.value=Ne.__value="5";var Be=y(Ne);Be.value=Be.__value="6";var $e=y(Be);$e.value=$e.__value="7";var Oe=y($e);Oe.value=Oe.__value="8";var gt=y(Oe);gt.value=gt.__value="9",F(yt),F(vt),Y(4),F(bt),F(Ce);var ht=y(Ce,4),It=y(A(ht),8),Te=y(A(It),2),Et=y(A(Te),4),je=A(Et);je.value=je.__value="0";var Ue=y(je);Ue.value=Ue.__value="1";var ze=y(Ue);ze.value=ze.__value="2";var De=y(ze);De.value=De.__value="3";var We=y(De);We.value=We.__value="4";var Pe=y(We);Pe.value=Pe.__value="5";var Ze=y(Pe);Ze.value=Ze.__value="6";var Ve=y(Ze);Ve.value=Ve.__value="7";var He=y(Ve);He.value=He.__value="8";var xt=y(He);xt.value=xt.__value="9",F(Et),Y(4),F(Te);var wt=y(Te,8),Mt=A(wt),St=y(A(Mt),2),Ke=A(St);Ke.value=Ke.__value="1.0";var Ye=y(Ke);Ye.value=Ye.__value="0.9";var qe=y(Ye);qe.value=qe.__value="0.8";var _t=y(qe);_t.value=_t.__value="0.7",F(St),F(Mt),Y(6),F(wt),Y(6),F(It),Y(6),F(ht),Rt(Ft,ft),hn()}export{Ln as component};
